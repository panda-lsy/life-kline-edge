# æµ‹è¯•è¿è¡ŒæŒ‡å—

## ğŸ”§ é—®é¢˜è§£å†³

å¦‚æœé‡åˆ° `EBUSY: resource busy or locked` é”™è¯¯ï¼Œè¯·å°è¯•ä»¥ä¸‹æ–¹æ³•ï¼š

### æ–¹æ³• 1: å…³é—­æ‰€æœ‰ç¨‹åº

1. å…³é—­æ‰€æœ‰ IDEï¼ˆVSCodeã€WebStorm ç­‰ï¼‰
2. å…³é—­æ‰€æœ‰ç»ˆç«¯/å‘½ä»¤è¡Œçª—å£
3. å…³é—­å…¶ä»–å¯èƒ½å ç”¨ node_modules çš„ç¨‹åº
4. é‡æ–°æ‰“å¼€ç»ˆç«¯ï¼Œè¿è¡Œå®‰è£…å‘½ä»¤

### æ–¹æ³• 2: é‡å¯ç›¸å…³è¿›ç¨‹

åœ¨ Windows ä»»åŠ¡ç®¡ç†å™¨ä¸­:
- ç»“æŸæ‰€æœ‰ `node.exe` è¿›ç¨‹
- ç»“æŸ IDE ç›¸å…³è¿›ç¨‹
- ç„¶åé‡æ–°è¿è¡Œå®‰è£…

### æ–¹æ³• 3: åˆ é™¤ lock æ–‡ä»¶

```bash
# åˆ é™¤ package-lock.json
rm package-lock.json

# é‡æ–°å®‰è£…
npm install
npm install --save-dev vitest @vitest/ui happy-dom @vitest/coverage-v8
```

---

## ğŸ“¦ å®‰è£…æµ‹è¯•ä¾èµ–

### å‘½ä»¤

```bash
npm install --save-dev vitest @vitest/ui happy-dom @vitest/coverage-v8
```

### é¢„æœŸè¾“å‡º

å®‰è£…æˆåŠŸåï¼Œpackage.json çš„ devDependencies åº”åŒ…å«:
- vitest
- @vitest/ui
- happy-dom
- @vitest/coverage-v8

---

## ğŸ§ª è¿è¡Œæµ‹è¯•

### 1. åŸºç¡€æµ‹è¯•

```bash
npm test
```

**é¢„æœŸç»“æœ**:
```
 âœ“ src/utils/bazi/__tests__/bazi.test.ts (40)
   âœ“ åŸºç¡€åŠŸèƒ½æµ‹è¯• (4)
   âœ“ æ€§åˆ«å·®å¼‚æµ‹è¯• (2)
   âœ“ ä¸åŒæ—¥æœŸæµ‹è¯• (3)
   âœ“ ä¸åŒæ—¶é—´æµ‹è¯• (3)
   âœ“ å·²çŸ¥æ¡ˆä¾‹éªŒè¯ (3)
   âœ“ è¾¹ç•Œæƒ…å†µæµ‹è¯• (4)
   âœ“ æ•°æ®ç±»å‹éªŒè¯ (3)
   âœ“ æ€§èƒ½æµ‹è¯• (2)
   âœ“ æ—¶åŒºå¤„ç†æµ‹è¯• (2)
   âœ“ å¤§è¿å‘¨æœŸæµ‹è¯• (3)
   âœ“ é”™è¯¯å¤„ç†æµ‹è¯• (2)
   âœ“ è¿ç»­æ€§æµ‹è¯• (2)

 Test Files  1 passed (1)
     Tests  40 passed (40)
  Start at 12:52:15
  Duration 123ms
```

### 2. äº¤äº’å¼æµ‹è¯• UI

```bash
npm run test:ui
```

è¿™ä¼šæ‰“å¼€ä¸€ä¸ªæµè§ˆå™¨ç•Œé¢ï¼Œå¯ä»¥:
- å¯è§†åŒ–æŸ¥çœ‹æµ‹è¯•ç»“æœ
- å•ç‹¬è¿è¡ŒæŸä¸ªæµ‹è¯•
- æŸ¥çœ‹ä»£ç è¦†ç›–ç‡

### 3. æµ‹è¯•è¦†ç›–ç‡

```bash
npm run test:coverage
```

ç”Ÿæˆè¦†ç›–ç‡æŠ¥å‘Šï¼Œä¿å­˜åˆ° `coverage/` ç›®å½•ã€‚

**é¢„æœŸè¦†ç›–ç‡**:
```
 % Coverage report from v8
-------------|---------|----------|---------|---------|-------------------
File         | % Stmts | % Branch | % Funcs | % Lines | Uncovered Line #s
-------------|---------|----------|---------|---------|-------------------
All files    |   90.12 |    85.71 |     100 |   90.24 |
 bazi.ts     |   92.31 |    88.89 |     100 |   92.31 | 45,67
-------------|---------|----------|---------|---------|-------------------
```

---

## ğŸ› å¸¸è§é—®é¢˜

### Q1: æ‰¾ä¸åˆ°æ¨¡å— 'vitest'

**åŸå› **: vitest æœªå®‰è£…

**è§£å†³**: è¿è¡Œ `npm install --save-dev vitest @vitest/ui happy-dom`

### Q2: æ‰¾ä¸åˆ° 'lunar-javascript'

**åŸå› **: ä¾èµ–æœªå®‰è£…

**è§£å†³**: è¿è¡Œ `npm install`

### Q3: æµ‹è¯•å¤±è´¥

**å¯èƒ½åŸå› **:
- å…«å­—è®¡ç®—é€»è¾‘æœ‰é”™è¯¯
- æµ‹è¯•ç”¨ä¾‹é¢„æœŸå€¼ä¸æ­£ç¡®
- lunar-javascript ç‰ˆæœ¬ä¸åŒ¹é…

**è§£å†³**:
- æ£€æŸ¥é”™è¯¯ä¿¡æ¯
- æŸ¥çœ‹ src/utils/bazi/bazi.ts å®ç°
- ç¡®è®¤ lunar-javascript ç‰ˆæœ¬

### Q4: éƒ¨åˆ†æµ‹è¯•è·³è¿‡

**åŸå› **: å¯èƒ½æ˜¯æµ‹è¯•ç¯å¢ƒé…ç½®é—®é¢˜

**è§£å†³**:
- æ£€æŸ¥ vitest.config.ts
- ç¡®è®¤ happy-dom æ­£å¸¸å·¥ä½œ

---

## ğŸ“ æµ‹è¯•è¯´æ˜

### æµ‹è¯•æ–‡ä»¶ä½ç½®

- **ä¸»æµ‹è¯•**: `src/utils/bazi/__tests__/bazi.test.ts`
- **æµ‹è¯•é…ç½®**: `vitest.config.ts`
- **æµ‹è¯•è®¾ç½®**: `src/test/setup.ts`

### æµ‹è¯•èŒƒå›´

40+ ä¸ªæµ‹è¯•ç”¨ä¾‹ï¼Œè¦†ç›–:
- âœ… åŸºç¡€åŠŸèƒ½ï¼ˆå››æŸ±ã€äº”è¡Œã€å¤§è¿ï¼‰
- âœ… æ€§åˆ«å·®å¼‚ï¼ˆç”·é¡ºå¥³é€†ï¼‰
- âœ… æ—¥æœŸè¾¹ç•Œï¼ˆé—°å¹´ã€å¹´åˆå¹´æœ«ï¼‰
- âœ… æ—¶é—´è¾¹ç•Œï¼ˆ24å°æ—¶ã€12åœ°æ”¯ï¼‰
- âœ… å·²çŸ¥æ¡ˆä¾‹ï¼ˆ3ä¸ªéªŒè¯æ¡ˆä¾‹ï¼‰
- âœ… æ•°æ®ç±»å‹ï¼ˆå¤©å¹²åœ°æ”¯æœ‰æ•ˆæ€§ï¼‰
- âœ… æ€§èƒ½è¦æ±‚ï¼ˆ< 100msï¼‰
- âœ… é”™è¯¯å¤„ç†

---

## âœ… éªŒè¯æµ‹è¯•æˆåŠŸ

æˆåŠŸçš„æ ‡å¿—:
1. æ‰€æœ‰ 40+ æµ‹è¯•é€šè¿‡
2. æ²¡æœ‰é”™è¯¯æˆ–è­¦å‘Š
3. è¦†ç›–ç‡ > 85%
4. æ€§èƒ½æµ‹è¯•é€šè¿‡ï¼ˆ< 100msï¼‰

---

## ğŸš€ ä¸‹ä¸€æ­¥

æµ‹è¯•é€šè¿‡å:
1. âœ… ç¡®è®¤æ ¸å¿ƒç®—æ³•æ­£ç¡®æ€§
2. âœ… ç»§ç»­ä»»åŠ¡ 11.1.2ï¼ˆæœ€ç»ˆæµ‹è¯•ä¸éªŒè¯ï¼‰
3. âœ… å‡†å¤‡æäº¤ä½œå“

---

**æœ€åæ›´æ–°**: 2026-01-09
